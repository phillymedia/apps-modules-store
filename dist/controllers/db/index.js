"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.db=void 0;var _lodash=require("lodash"),_phillyHelpers=require("philly-helpers"),_config=require("../../config"),_mongoose=require("mongoose"),_mongoose2=_interopRequireDefault(_mongoose);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var autoIndex=!0;_config.debug&&_mongoose2.default.set("debug",!0),"production"===_config.env&&(autoIndex=!1),_mongoose2.default.Promise=global.Promise,_mongoose2.default.connect(_config.database.url,{autoIndex:autoIndex,useMongoClient:!0}).then(function(){_phillyHelpers.log.debug("Mongoose connection open.")}).catch(function(err){throw _phillyHelpers.log.info("Mongoose default connection error: "+err),new Error("Unable to connect to database!")}),_mongoose2.default.connection.on("error",function(err){throw _phillyHelpers.log.info("Mongoose default connection error: "+err),new Error("Unable to connect to database!")}),_mongoose2.default.connection.on("disconnected",function(){_phillyHelpers.log.debug("Mongoose default connection disconnected.")}),process.on("SIGINT",function(){_mongoose2.default.connection.close(function(){_phillyHelpers.log.debug("Mongoose default connection disconnected through app termination."),process.exit(0)})}).on("SIGTERM",function(){_mongoose2.default.connection.close(function(){_phillyHelpers.log.debug("Mongoose default connection disconnected through app termination."),process.exit(0)})}),exports.db=_mongoose2.default,require("../../models/Detail"),require("../../models/Feed"),require("../../models/Log");var applicationModel=require("../../models/Application");require("../../models/Topic"),require("../../models/Endpoint"),require("../../models/Subscription"),require("../../models/Stat"),"production"===_config.env&&applicationModel.collection.indexes(function(err,indexes){if(err){if(26===err.code)throw new Error("Database doesn't yet exist! Indexes will not be built.");throw err}if(!(0,_lodash.some)(indexes,{key:{arn:1}}))throw new Error("Indexes do not exist and will not be built!")});