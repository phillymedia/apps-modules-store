"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _phillyHelpers=require("philly-helpers"),_config=require("../../config"),_core=require("../core"),_core2=_interopRequireDefault(_core),_schema2=require("./schema"),_schema3=_interopRequireDefault(_schema2),_lodash=require("lodash");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function find(settings,callback){var params={source:settings.source,type:settings.type,name:settings.name,limit:1};_core2.default.find(_schema3.default,params,function(err,data){return err?callback(err):((0,_lodash.isEmpty)(data)||(data=data[0].content),callback(null,data))})}function add(settings,callback){var params={expireAt:(0,_phillyHelpers.minutesFromNow)(settings.delay),source:settings.source,type:settings.type,name:settings.name,content:settings.content};_core2.default.add(_schema3.default,params,function(err,data){return err?err.code===_config.database.errors.duplicate?(settings.schema=_schema3.default,find(settings,callback)):callback(err):callback(null,data.content)})}function remove(_ref,callback){var source=_ref.source,type=_ref.type,name=_ref.name;_core2.default.remove(_schema3.default,{source:source,type:type,name:name},callback)}function exists(_ref2,callback){var source=_ref2.source,type=_ref2.type,name=_ref2.name;_core2.default.exists(_schema3.default,{source:source,type:type,name:name},callback)}exports.default={find:find,add:add,remove:remove,exists:exists};